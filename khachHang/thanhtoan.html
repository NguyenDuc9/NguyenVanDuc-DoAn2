<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Thanh to√°n ƒë∆°n h√†ng</title>
    <link rel="stylesheet" href="../CSS/screen1.css" />
    <link rel="stylesheet" href="../CSS/screen2.css" />
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 30px;
        background-color: #f4f4f4;
      }
      h2 {
        color: #333;
        text-align: center;
      }
      .section {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }
      th,
      td {
        border: 1px solid #ccc;
        padding: 8px;
        text-align: center;
      }
      th {
        background-color: #eee;
      }
      .tong-tien {
        font-weight: bold;
        font-size: 18px;
        color: #d9534f;
        text-align: right;
        margin-top: 10px;
      }
      .qr {
        text-align: center;
        margin-top: 20px;
      }
      .qr img {
        width: 280px;
        height: 280px;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      }
      button {
        display: block;
        margin: 25px auto;
        padding: 12px 30px;
        background-color: #28a745;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
      }
      button:hover {
        background-color: #218838;
      }
    </style>
  </head>
  <body>
    <div>
      <div style="background-color: white">
        <div class="head1">
          <div style="width: 50%" class="a">
            <a href="main_screen1.html"
              >Ti·ªám hoa Xu√¢n Th√†nh - Uy t√≠n - Chuy√™n nghi·ªáp - Ph·ª•c v·ª• 24/7</a
            >
          </div>
          <div style="width: 10%"></div>
          <div style="width: 30%" class="head1 hide-on-mobile">
            <div>
              <div class="menu-login">
                <div class="menu-button">T√†i kho·∫£n</div>
                <ul class="dropdown">
                  <li><a href="doiMK.html">ƒê·ªïi m·∫≠t kh·∫©u</a></li>
                  <li><a href="Login.html">ƒêƒÉng xu·∫•t</a></li>
                </ul>
              </div>
            </div>
            <div>S·∫£n ph·∫©m</div>
            <div>H·ªá th·ªëng c·ª≠a h√†ng</div>
          </div>
        </div>
        <div class="head2" style="background-color: white">
          <div>
            <img src="../anh/shopXuanThanh.png" alt="" />
          </div>
          <div class="search-box" style="margin-top: 15px">
            <select>
              <option>Ch·ªçn danh m·ª•c...</option>
              <option>Hoa c∆∞·ªõi</option>
              <option>Hoa sinh nh·∫≠t</option>
              <option>Hoa c·∫£m ∆°n</option>
            </select>
            <input type="text" placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m..." />
            <button>üîç</button>
          </div>
          <div style="width: 20px"></div>
          <div class="DienThoai">
            <div><img src="../anh/dienthoai.png" alt="" /></div>
            <div>
              <p>G·ªçi ƒêi·ªán</p>
              <p style="margin-top: -7px">092.3355.800</p>
            </div>
          </div>
          <div class="DienThoai">
            <div><img src="../anh/dienthoai.png" alt="" /></div>
            <div>
              <p>Li√™n h·ªá zalo</p>
              <p style="margin-top: -7px">092.3355.800</p>
            </div>
          </div>
        </div>
      </div>

      <div class="head1 hide-on-mobile" style="height: 50px; line-height: 50px">
        <div style="margin-left: 12%; width: 27.5%">
          <div class="menu-container">
            <!-- <i class="fas fa-bars"></i> -->
            <div class="menu-title">
              <p style="margin-top: -10px">&#9776; Danh m·ª•c s·∫£n ph·∫©m</p>
            </div>
          </div>

          <!-- Sidebar menu -->
          <div class="sidebar">
            <div class="menu-item">
              Khuy·∫øn m√£i g·ªëc <span class="hot">HOT</span>
            </div>

            <div class="menu-item">
              <span>Hoa T∆∞∆°i ‚ñ∏</span>
              <div class="submenu">
                <div>Hoa c·∫©m ch∆∞·ªõng</div>
                <div>Hoa c·∫©m t√∫ c·∫ßu</div>
                <div>Hoa c√°t t∆∞·ªùng</div>
                <div>Hoa ƒë·ªìng ti·ªÅn</div>
                <div>Hoa h·ªìng</div>
                <div>Hoa H∆∞·ªõng d∆∞∆°ng</div>
                <div>Hoa lan</div>
                <div>Hoa ly</div>
              </div>
            </div>

            <div class="menu-item">
              <span>Ki·ªÉu d√°ng ‚ñ∏</span>
              <div class="submenu">
                <div>Gi·ªè hoa</div>
                <div>B√¨nh hoa</div>
                <div>B√≥ hoa</div>
                <div>Hoa h·ªôp g·ªó</div>
                <div>K·ªá hoa khai</div>
                <div>L√£ng hoa</div>
              </div>
            </div>

            <div class="menu-item">
              <span>Hoa sinh nh·∫≠t ‚ñ∏</span>
              <div class="submenu">
                <div>T·∫∑ng sinh nh·∫≠t b·∫°nb·∫°n</div>
                <div>Hoa t·∫∑ng v·ª£</div>
                <div>Hoa t·∫∑ng x·∫øp</div>
                <div>Hoa t·∫∑ng ƒë·ªìng nghi·ªáp</div>
                <div>T·∫∑ng ng∆∞·ªùi y√™u</div>
              </div>
            </div>

            <div class="menu-item">Hoa Chia Bu·ªìn</div>
            <div class="menu-item">Hoa c·∫£m ∆°n</div>
            <div class="menu-item">Hoa khai tr∆∞∆°ng</div>
            <div class="menu-item">Hoa ng√†y nh√† gi√°o</div>
            <div class="menu-item">Hoa ng√†y ph·ª• n·ªØ</div>
            <div class="menu-item">Hoa t√¨nh y√™u</div>
          </div>
        </div>
        <div style="width: 30%; gap: 15px; line-height: 50px; display: flex">
          <div>Trang ch·ªß</div>
          <div>S·∫£n ph·∫©m</div>
          <div>Gi·ªõi thi·ªáu</div>
          <div>Tin t·ª©c</div>
          <div>Li√™n h·ªá</div>
        </div>
        <div style="width: 25%">
          <a href="shopping_cart.html"> Gi·ªè h√†ng üõí</a>
        </div>
      </div>
    </div>
    <div
      style="
        font-family: Arial, sans-serif;
        background-color: #fff8f0;
        padding: 30px;
        color: #333;
      "
    >
      <h2 style="text-align: center; color: #ff6600">Thanh to√°n ƒë∆°n h√†ng</h2>

      <div id="order-info" style="margin-top: 20px"></div>

      <img
        src="../anh/qr.png"
        alt="QR code"
        style="display: block; margin: 30px auto; width: 200px"
      />
      <p style="text-align: center; font-size: 16px">
        Qu√©t m√£ ƒë·ªÉ thanh to√°n ƒë∆°n h√†ng
      </p>

      <button
        id="btnXacNhan"
        onclick="xacNhanThanhToan()"
        style="
          display: block;
          margin: 25px auto;
          padding: 12px 30px;
          background-color: orange;
          color: white;
          border: none;
          border-radius: 8px;
          cursor: pointer;
          font-size: 16px;
        "
      >
        X√°c nh·∫≠n thanh to√°n
      </button>
    </div>

    <script>
      // üßæ HI·ªÇN TH·ªä TH√îNG TIN ƒê∆†N H√ÄNG
      function loadOrder() {
        const order = JSON.parse(localStorage.getItem("donHangDangCho"));
        const orderInfo = document.getElementById("order-info");

        if (!order) {
          orderInfo.innerHTML =
            '<p style="text-align:center; color:red;">‚ùå Kh√¥ng c√≥ ƒë∆°n h√†ng n√†o c·∫ßn thanh to√°n.</p>';
          document.getElementById("btnXacNhan").style.display = "none";
          return;
        }

        let html = `
      <div style="margin-bottom: 20px;">
        <h3>üë§ Kh√°ch h√†ng: ${order.khachHang?.hoTen || "Kh√¥ng c√≥"}</h3>
        <p>üè† ƒê·ªãa ch·ªâ: ${order.khachHang?.diaChi || "Kh√¥ng c√≥"}</p>
        <p>üìû SƒêT: ${order.khachHang?.soDienThoai || "Kh√¥ng c√≥"}</p>
      </div>

      <table style="width:100%; border-collapse: collapse; margin-top: 10px;">
        <tr style="background-color: #ffedcc;">
          <th style="border:1px solid #ccc; padding:8px;">M√£ SP</th>
          <th style="border:1px solid #ccc; padding:8px;">T√™n s·∫£n ph·∫©m</th>
          <th style="border:1px solid #ccc; padding:8px;">S·ªë l∆∞·ª£ng</th>
          <th style="border:1px solid #ccc; padding:8px;">ƒê∆°n gi√°</th>
          <th style="border:1px solid #ccc; padding:8px;">Th√†nh ti·ªÅn</th>
        </tr>
        ${(order.gioHang || [])
          .map(
            (sp, i) => `
          <tr style="background-color: ${i % 2 === 0 ? "#fff" : "#f9f9f9"};">
            <td style="border:1px solid #ccc; padding:8px;">${
              sp.maSanPham || ""
            }</td>
            <td style="border:1px solid #ccc; padding:8px;">${sp.name}</td>
            <td style="border:1px solid #ccc; padding:8px;">${sp.quantity}</td>
            <td style="border:1px solid #ccc; padding:8px;">${Number(
              sp.price
            ).toLocaleString()} VND</td>
            <td style="border:1px solid #ccc; padding:8px;">${(
              sp.price * sp.quantity
            ).toLocaleString()} VND</td>
          </tr>`
          )
          .join("")}
      </table>

      <h3 style="text-align:right; margin-top:15px;">
        üí∞ T·ªïng c·ªông: ${Number(order.tongTien).toLocaleString()} VND
      </h3>
    `;
        orderInfo.innerHTML = html;
      }

      // üí≥ X√ÅC NH·∫¨N THANH TO√ÅN
      function xacNhanThanhToan() {
        const order = JSON.parse(localStorage.getItem("donHangDangCho"));
        if (!order) {
          alert("Kh√¥ng c√≥ ƒë∆°n h√†ng n√†o ƒë·ªÉ thanh to√°n.");
          return;
        }

        // N·∫øu ch∆∞a c√≥ m√£ ƒë∆°n h√†ng th√¨ t·∫°o m·ªõi
        if (!order.maDonHang) {
          order.maDonHang = "DH" + Date.now();
        }

        order.trangThai = "ƒê√£ thanh to√°n";

        // L∆∞u v√†o danh s√°ch ƒë∆°n h√†ng
        let orders = JSON.parse(localStorage.getItem("orders")) || [];
        const index = orders.findIndex(
          (o) => o && o.maDonHang === order.maDonHang
        );

        if (index !== -1) {
          orders[index] = order;
        } else {
          orders.push(order);
        }

        localStorage.setItem("orders", JSON.stringify(orders));
        localStorage.removeItem("donHangDangCho");
        localStorage.removeItem("cart");

        // L∆∞u ƒë∆°n h√†ng v·ª´a thanh to√°n ƒë·ªÉ donhang.html hi·ªÉn th·ªã
        localStorage.setItem("donHangVuaThanhToan", JSON.stringify(order));

        alert("‚úÖ Thanh to√°n th√†nh c√¥ng!");
        window.location.href = "donhang.html";
      }

      window.addEventListener("DOMContentLoaded", loadOrder);
    </script>
  </body>
</html>
